---
layout: post
title: "游戏服务器设计与实现一：百万级 pcu 的全区全服游戏"
date: 2024-05-01
last_modified_at: 2024-05-01
categories: [游戏开发]
tags: [gameserver]
---

* 目录  
{:toc}
<br/>

我太有资格写这篇文章了，因为我就亲手设计过 pcu 可以达到百万级的全区全服类型的游戏服务器。    

这个游戏是我公司研发的休闲类型游戏，由 penguin 厂独代，研发的时候，经历了 p 厂好几轮的 TDR (technical design review) 拷打，最终稳稳上线。虽然实际上线后，最高同时在线只到过 30 万，但这是游戏运营层面的问题，架构层面完全是可以稳稳达到百万以上的，几百万都没问题。       

弄过这种级别的架构之后，再看原神这种大 dau 的开放世界游戏，或者鸣潮这种号称有 3100 万预约的，都不觉得有啥难的，反而开放世界的游戏，负载是很小的，因为偏单机向。而像王者荣耀这种 pcu 接近千万级的，也不难，就是个开房间类型的游戏而已，它里面的难点只有网络同步这一块。    

ok，吹完水，开始写具体的工程实践经验。   

---

# 1. 全区全服的定义

此处提到的全区全服，是指所有玩家在一个大通服里一起游戏，就像王者荣耀那样，但战斗的时候并不是所有人在同一个大世界，而是开房间式的，凑够 n 个人就开始一盘游戏。   

几乎所有的全区全服类型的游戏都可以归类为开房间类型的，区别只是房间人数的多少而已。举几个例子：开放世界的，pve 的时候可以理解为单人房间，pvp 的时候是多人房间；棋牌类型的，n个人一桌，这一桌可以定义为一个房间；moba 类型的，像王者，也是几个人一个房间。    

btw，棋牌类型的，早期的架构都是房间+桌子，一个房间分n个桌子，一个桌子坐n个人，但其实放到现在，完全没必要这样设计的，就统一抽象成房间就行了，更容易做负载均衡。  

---

# 2. 架构设计

一切的难点都在于量级上，当 pcu 到达百万级的时候，负载均衡成为最重要的问题，整个架构都要设计成可以横向扩容的，在各个层面都要做好负载均衡。   

先画一个典型的架构。  





---










