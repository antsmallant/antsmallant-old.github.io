---
layout: post
title: "lua gc 算法设计与实现"
date: 2023-01-01
last_modified_at: 2023-01-01
categories: [lua]
tags: [lua gc 垃圾回收]
---

* 目录  
{:toc}
<br/>  


本文将介绍 lua 的 gc 算法。第一部分讲设计与实现，第二部分如何通过调参优化减少 gc 带来的 cpu 突刺。  

## 设计与实现
lua 的 gc 算法，大体可以分为两个时期，第一个是 lua5.0 及之前的，都是采用的 two-color mark sweep 算法；第二个是 lua5.1 及之后的，

### 历史
lua 5.0 的时候，gc 算法采用的是 stop the world 类型的。
|版本|算法|特点|
|--|--|--|
|5.0|双色 mark-sweep|stop the world式的，|
|5.1|增量 gc，三色 mark-sweep||
|5.2|增量 gc，分代 gc（实验性的）||
|5.3|三色 mark-||
|5.4|||

### 双色标记法是如何实现的？

### 增量 gc 是如何实现的？

### 分代 gc 是如何实现的？



## 调参优化
游戏服务器对于 cpu 突刺是很敏感的，这很容易引起掉帧的问题。掉帧就是游戏服运行过程中每秒跑的逻辑帧数不及预期，比如本来设计是每秒20帧，但是由于 gc 占用了 cpu，导致一秒跑不了 20 帧。  

优化的思路

## 总结


