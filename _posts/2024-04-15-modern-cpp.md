---
layout: post
title: "现代 C++"
date: 2024-04-15
last_modified_at: 2024-04-15
categories: [c++]
tags: [c++]
---

* 目录  
{:toc}
<br/>

关于现代 C++ 的书和文章遍地都是，但无论如何，每个人都应该自己归纳总结一下，故有此文。  

所谓现代 C++，指的是从 C++11 开始的 C++，从 C++11 开始，加入一些比较现代的特性，使得用 C++ 开发少了很多心智负担，程序也更加健壮。从 C++11 开始，每 3 年发布一个新版本，到今年（2024）已经有 5 个版本了，分别是 C++11、C++14、C++17、C++20、C++23，这 5 个版本引入了上百个新特性，这些特性使得 C++ “看起来像一门新语言”。   

---

# 各版本的特性

## C++11 新特性

C++11 是一个 major 版本，有不少新特性，有些是有用但不算很重要，个人认为最重要的特性包括：  

* 智能指针: unique_ptr, shared_ptr
* 移动语义
* 新的内存模型
* lambda 表达式
* auto 和 decltype 推导


### 智能指针


### 移动语义


### lambda 表达式

---

## C++14 新特性
C++14 是一个 minor 版本，没什么重要的新特性，主要是在给 C++11 打补丁，为使用者 “带来极大方便”，实现 “对新手更为友好” 这一目标。 

与方便使用相关的特性，就是支持函数返回值推导了，在 C++11 中这么写是编译不过的，在 C++14 中支持了：  
```
auto func(int i) {
    return i;
}
```

---

## C++17 新特性
C++17 是一个 major 版本，

重要的特性包括：  
* 结构化绑定


### 结构化绑定



---

## C++20 新特性
C++20 也是一个 major 版本，有很重要的更新，"The Big Four"，即四个重要的特性，分别是：概念、范围、协程和模块。  

由于平常用 lua 多，所以对于协程这个特性比较关注。C++20 实际上提供的是协程的基础设施，相当原始，是面向库开发者的，普通程序员应该使用基于这些基础开发的各种便于使用的库。比如 C++23 就引入了这样的库，叫 generator。  

我有点不太理解，在 lua 里面，协程挺简单的，到了 C++ 这里，怎么变得那么复杂，以至于人们要写那么冗长的文章来介绍它。  



---

## C++23 新特性

---

# 若干重要的概念
可能有多年 c++ 编程经验，但回过头来发现，对于一些基础概念却并不怎么熟悉，比如表达式、语句这些。   

## 表达式
表达式是由一个或多个运算对象（operand）组成，对表达式求值将得到一个结果。字面值和变量是最简单的表达式（expression），其结果就是字面值和变量的值。把一个运算符（operator）和一个或多个运算对象组合起来可以生成较复杂的表达式。[3]  

## 语句


参考：《现代c++编程》的第8章 https://weread.qq.com/web/reader/7b032db0813ab864eg0111c1k9bf32f301f9bf31c7ff0a60?

## 函数
函数是一个命名了的代码块，我们通过调用函数执行相应的代码。函数可以有 0 个或多个参数，而且（通常）会产生一个结果。可以重载函数，也就是说，同一个名字可以对应几个不同的函数。[3]     

## 列表初始化
是 c++11 引入的一种新的初始化方式，使用花括号 {} 来初始化变量，其目的是为了统一各种初始化。 

这两个语句 `int c = {100};`，`int c {100};` 在多数时候被编译器同等处理。 

这种初始化形式的一个重要特点：当初始值存在丢失信息的风险时，编译器会报错，比如用 double 初始化 int 变量：`int c {200.45};`。  


## 右值引用、移动语义、完美转发

### 左值与右值
左值即出现在赋值语句的等号左边的值，它必须对应于一个地址。

[1]:14.12

赋值语句的结果仍然是一个左值，为何这样说？因为像这样的语句是合法的： `(a = 4) = 8;`，其结果是 `a = 8`。[1] 

右值引用就是绑定到右值上的引用，要用 && 而不是 & 来获得右值引用。   

例外情况：   
* const 引用可以绑定到右值上，像这样是合法的： `const int& c = 100`，它相当于下面两行代码：  

```c++
int temp = 100;
const int& c = temp;
```

参考：
《现代c++语言核心特性解析》https://weread.qq.com/web/reader/22d32dd0726fa07122d86dbk67c32d7022f67c6a1e7ce82?


## const
const 在各个位置的意义？
成员函数末尾的 const
开头的 const

## const_expr

为何 const_expr 重要？ 


## 模板

---

# C++ 常用优化手段

## Pimpl

Pimpl 惯用法通过降低类的客户和类实现者之间的依赖性，减少了构建的遍数。[2]  


---

# todo
* 搞清楚 c++ 的 lvalue 以及 rvalue
* 搞清楚 c++ 的 const / const_expr
* 详细阅读《modern effective c++》条款7的大括号初始化

---

# 总结

---

# 参考
[1] 王健伟. C++新经典. 北京: 清华大学出版社, 2020-08-01.   

[2] [美]Scott Meyers. Effective Modern C++(中文版). 高博. 北京: 中国电力出版社, 2018-4: 149.  

[3] [美] Stanley B. Lippman, Josée Lajoie, Barbara E. Moo. C++ Primer 中文版（第 5 版）. 王刚, 杨巨峰. 北京: 电子工业出版社, 2013-9: 120, 154, 182. 